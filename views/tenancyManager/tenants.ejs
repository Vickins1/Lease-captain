<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lease Captain | Dashboard</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&amp;display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/adminlte.min2167.css?v=3.2.0">
    <link rel="icon" type="image/png" sizes="56x56" href="/assets/images/1.png">
</head>

<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">

        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__wobble" src="/assets/images/2.png" alt="AdminLTELogo" height="150" width="150">
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Navbar Search -->
                <li class="nav-item">
                    <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                        <i class="fas fa-search"></i>
                    </a>
                    <div class="navbar-search-block">
                        <form class="form-inline">
                            <div class="input-group input-group-sm">
                                <input class="form-control form-control-navbar" type="search" placeholder="Search"
                                    aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-navbar" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>

                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge"></span>
                    </a>

                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
                <li class="nav-item ">
                    <a href="/logout" class="nav-link" role="button">
                        <i class="nav-icon fas fa-sign-out-alt"></i>
                    </a>
                </li>

            </ul>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-light-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/" class="brand-link">
                <img src="/assets/images/2.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                    style="opacity: .8">
                <h4 class="brand-text font-weight-bold"><strong>Lease Captain</strong></h4>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block" aria-haspopup="true" aria-expanded="false">
                            <span>Welcome,</span>
                            <strong>
                                <%= currentUser.username %>
                            </strong>
                        </a>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                        <!-- Dashboard -->
                        <li class="nav-item">
                            <a href="/dashboard" class="nav-link active"
                                style="background-color: #003366; color: #ffffff;">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard</p>
                            </a>
                        </li>

                        <!-- Property Management -->
                        <li class="nav-header"><strong>PROPERTY MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/properties" class="nav-link">
                                <i class="nav-icon fas fa-building"></i>
                                <p>Properties</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/property/units" class="nav-link">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Property Units</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/propertyListing" class="nav-link">
                                <i class="nav-icon fas fa-list-alt"></i>
                                <p>List Properties</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon fas fa-chart-line"></i>
                                <p>
                                    Tenant Management
                                    <i class="right fas fa-angle-left"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="/tenancy-manager/tenants" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Tenants</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/maintenance-requests" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Maintenance Requests</p>
                                    </a>
                                </li>
                                
                            </ul>
                        </li>

                        <!-- Land Management -->
                        <li class="nav-header"><strong>LAND MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lands" class="nav-link">
                                <i class="nav-icon fas fa-map"></i>
                                <p>Registered Lands</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/land-parcels" class="nav-link">
                                <i class="nav-icon fas fa-th-large"></i>
                                <p>Land Parcels</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/land-reports" class="nav-link">
                                <i class="nav-icon fas fa-chart-area"></i>
                                <p>Land Reports</p>
                            </a>
                        </li>

                        <!-- Lease Management -->
                        <li class="nav-header"><strong>LEASE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/leases" class="nav-link">
                                <i class="nav-icon fas fa-file-contract"></i>
                                <p>Leases</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lease-templates" class="nav-link">
                                <i class="nav-icon fas fa-file-alt"></i>
                                <p>Lease Templates</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lease-reports" class="nav-link">
                                <i class="nav-icon fas fa-chart-bar"></i>
                                <p>Lease Reports</p>
                            </a>
                        </li>

                        <!-- Vehicle Management -->
                        <li class="nav-header"><strong>VEHICLE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicles" class="nav-link">
                                <i class="nav-icon fas fa-car"></i>
                                <p>Registered Vehicles</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicle-parking" class="nav-link">
                                <i class="nav-icon fas fa-parking"></i>
                                <p>Parking Spaces</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicle-reports" class="nav-link">
                                <i class="nav-icon fas fa-clipboard-list"></i>
                                <p>Vehicle Reports</p>
                            </a>
                        </li>

                        <!-- Finance -->
                        <li class="nav-header"><strong>FINANCE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/payments" class="nav-link">
                                <i class="nav-icon fas fa-money-bill-wave"></i>
                                <p>Payment Transactions</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/reports-invoices" class="nav-link">
                                <i class="nav-icon fas fa-file-invoice"></i>
                                <p>Reports & Invoices</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/expenses" class="nav-link">
                                <i class="nav-icon fas fa-wallet"></i>
                                <p>Expense Tracking</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/budget-planning" class="nav-link">
                                <i class="nav-icon fas fa-chart-pie"></i>
                                <p>Budget Planning</p>
                            </a>
                        </li>

                        <!-- Notifications -->
                        <li class="nav-header"><strong>NOTIFICATION MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/sms&email" class="nav-link">
                                <i class="nav-icon fas fa-sms"></i>
                                <p>SMS & Email</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/sms&email" class="nav-link">
                                <i class="nav-icon fas fa-credit-card"></i>
                                <p>Credit Top-up</p>
                            </a>
                        </li>

                        <!-- Staff Management -->
                        <li class="nav-header"><strong>STAFF MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/staff-directory" class="nav-link">
                                <i class="nav-icon fas fa-user-tie"></i>
                                <p>Staff Directory</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/staff-attendance" class="nav-link">
                                <i class="nav-icon fas fa-calendar-check"></i>
                                <p>Attendance</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/staff-payroll" class="nav-link">
                                <i class="nav-icon fas fa-file-invoice-dollar"></i>
                                <p>Payroll</p>
                            </a>
                        </li>

                        <!-- Account Management -->
                        <li class="nav-header"><strong>ACCOUNT MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/profile" class="nav-link">
                                <i class="nav-icon fas fa-user"></i>
                                <p>Profile Settings</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/security" class="nav-link">
                                <i class="nav-icon fas fa-lock"></i>
                                <p>Security Settings</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/connect" class="nav-link">
                                <i class="nav-icon fas fa-link"></i>
                                <p>Payment Gateway</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/users" class="nav-link">
                                <i class="nav-icon fas fa-users"></i>
                                <p>User Accounts</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/upgrade-subscription" class="nav-link">
                                <i class="nav-icon fas fa-arrow-circle-up"></i>
                                <p>Upgrade Subscription</p>
                            </a>
                        </li>
                        <!-- Support -->
                        <li class="nav-item mt-auto">
                            <a href="/contacts" class="nav-link d-flex align-items-center justify-content-center"
                                style="background-color: #003366; color: #ffffff; border-radius: 5px; margin: 10px;">
                                <i class="fas fa-headset mr-2"></i>
                                <p>Support</p>
                            </a>
                        </li>
                    </ul>
                </nav>

            </div>

            <!-- /.sidebar -->

        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Tenant Management</h3>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body">
                                    <!-- Error Message -->
                                    <% if (error && error.length> 0) { %>
                                        <div class="alert alert-danger text-center" role="alert"
                                            style="font-size: 0.9rem;">
                                            <%= error %>
                                        </div>
                                        <% } %>

                                            <!-- Success Message -->
                                            <% if (success && success.length> 0) { %>
                                                <div class="alert alert-success text-center" role="alert"
                                                    style="font-size: 0.9rem;">
                                                    <%= success %>
                                                </div>
                                                <% } %>

                                                    <!-- Search bar for filtering tenants -->
                                                    <div class="row mb-4">
                                                        <div class="col-12 col-md-6">
                                                            <input type="text" id="tenantSearch" class="form-control"
                                                                placeholder="Search tenant by name, email, or property">
                                                        </div>
                                                        <button type="button" class="btn btn-dark w-30"
                                                            data-toggle="modal" data-target="#addTenantModal"
                                                            style="background-color: #003366; color: #ffffff;">
                                                            Add New Tenant
                                                        </button>
                                                    </div>
                                                    <!-- Section to display the tenant results dynamically -->
                                                    <div id="tenantResults">
                                                        <!-- The tenant table will be dynamically populated here -->
                                                    </div>

                                                    <!-- Tenants Table -->
                                                    <div class="table-responsive">
                                                        <table id="tenantTable"
                                                            class="table table-bordered table-striped table-hover table-sm small-table">
                                                            <thead class="text-center"
                                                                style="background-color: #00172f; color: white;">
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Name</th>
                                                                    <th>Email</th>
                                                                    <th>Phone</th>
                                                                    <th>Property</th>
                                                                    <th>Unit</th>
                                                                    <th>Door</th>
                                                                    <th>Lease Period</th>
                                                                    <th>Rent Paid</th>
                                                                    <th>Utility Paid</th>
                                                                    <th>Wallet</th>
                                                                    <th>Arrears</th>
                                                                    <th>Status</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody class="text-center"
                                                                style="background-color: #f8f9fa; color: black;">
                                                                <% tenants.forEach((tenant, index)=> { %>
                                                                    <tr style="cursor: pointer;" onclick="window.location.href='/tenancy-manager/tenant-report/<%= tenant._id %>'; 
                            event.stopPropagation();">
                                                                        <td>
                                                                            <%= (index + 1) + ((currentPage - 1) *
                                                                                perPage) %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.name %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.email %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.phone %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.property ? tenant.property.name
                                                                                : 'N/A' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.unit ? tenant.unit.unitType
                                                                                : 'N/A' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.doorNumber || 'N/A' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= new
                                                                                Date(tenant.leaseStartDate).toLocaleDateString()
                                                                                %> -
                                                                                <%= new
                                                                                    Date(tenant.leaseEndDate).toLocaleDateString()
                                                                                    %>
                                                                        </td>
                                                                        <td>Ksh.<%= tenant.rentPaid ?
                                                                                tenant.rentPaid.toFixed(2) : "0.00" %>
                                                                        </td>
                                                                        <td>Ksh.<%= tenant.utilityPaid ?
                                                                                tenant.utilityPaid.toFixed(2) : "0.00"
                                                                                %>
                                                                        </td>
                                                                        <td>Ksh.<%= tenant.walletBalance ?
                                                                                tenant.walletBalance.toFixed(2) : "0.00"
                                                                                %>
                                                                        </td>
                                                                        <td>Ksh.<%= tenant.outstandingPayments ?
                                                                                tenant.outstandingPayments.toFixed(2)
                                                                                : "0.00" %>
                                                                        </td>
                                                                        <td>
                                                                            <%= tenant.leaseStatus || 'N/A' %>
                                                                        </td>

                                                                    </tr>

                                                                    <% }) %>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.table-responsive -->

                                                    <!-- Pagination controls -->
                                                    <div class="d-flex justify-content-between mt-3">
                                                        <div>
                                                            <p>Showing <%= ((currentPage - 1) * perPage + 1) %> to
                                                                    <%= Math.min(currentPage * perPage, totalTenants) %>
                                                                        of <%= totalTenants %> tenants</p>
                                                        </div>
                                                        <div>
                                                            <div class="pagination-container text-center my-4">
                                                                <!-- Previous Button -->
                                                                <% if (currentPage> 1) { %>
                                                                    <a href="/tenancy-manager/tenants?page=<%= currentPage - 1 %>"
                                                                        class="btn btn-primary mr-2 pagination-btn"
                                                                        data-toggle="tooltip" data-placement="top"
                                                                        title="Previous Page">
                                                                        <i class="fas fa-arrow-left"></i> Previous
                                                                    </a>
                                                                    <% } %>

                                                                        <!-- Page Numbers -->
                                                                        <div class="pagination-buttons">
                                                                            <% for (let i=1; i <=totalPages; i++) { %>
                                                                                <a href="/tenancy-manager/tenants?page=<%= i %>"
                                                                                    class="btn <%= currentPage === i ? 'btn-primary active' : 'btn-outline-primary' %> pagination-btn"
                                                                                    data-toggle="tooltip"
                                                                                    data-placement="top"
                                                                                    title="Page <%= i %>">
                                                                                    <%= i %>
                                                                                </a>
                                                                                <% } %>
                                                                        </div>

                                                                        <!-- Next Button -->
                                                                        <% if (currentPage < totalPages) { %>
                                                                            <a href="/tenancy-manager/tenants?page=<%= currentPage + 1 %>"
                                                                                class="btn btn-primary ml-2 pagination-btn"
                                                                                data-toggle="tooltip"
                                                                                data-placement="top" title="Next Page">
                                                                                Next <i class="fas fa-arrow-right"></i>
                                                                            </a>
                                                                            <% } %>
                                                            </div>
                                                            <style>
                                                                .pagination-container {
                                                                    display: flex;
                                                                    justify-content: center;
                                                                    align-items: center;
                                                                    gap: 10px;
                                                                }

                                                                .pagination-btn {
                                                                    font-size: 10px;
                                                                    padding: 10px 20px;
                                                                    transition: all 0.3s ease-in-out;
                                                                }

                                                                .pagination-btn:hover {
                                                                    transform: scale(1.05);
                                                                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                                                                }

                                                                .pagination-btn:focus {
                                                                    outline: none;
                                                                    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
                                                                }

                                                                .pagination-buttons {
                                                                    display: flex;
                                                                    gap: 5px;
                                                                }

                                                                .pagination-btn.active {
                                                                    background-color: #003366;
                                                                    color: white;
                                                                    font-weight: bold;
                                                                }

                                                                .pagination-btn.btn-outline-primary {
                                                                    background-color: white;
                                                                    border: 2px solid #003366;
                                                                    color: #003366;
                                                                }

                                                                .pagination-btn.btn-outline-primary:hover {
                                                                    background-color: #0057ae;
                                                                    color: white;
                                                                }

                                                                .pagination-btn i {
                                                                    margin-right: 8px;
                                                                }

                                                                /* Add custom spacing for smaller screen sizes */
                                                                @media (max-width: 768px) {
                                                                    .pagination-btn {
                                                                        font-size: 14px;
                                                                        padding: 8px 16px;
                                                                    }
                                                                }
                                                            </style>
                                                        </div>
                                                    </div>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div>
                <!-- /.container-fluid -->
            </section>
            <!-- /.content -->

            <!-- Modal Structure -->
            <div class="modal fade" id="addTenantModal" tabindex="-1" role="dialog"
                aria-labelledby="addTenantModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header" style="color: #003366;">
                            <h5 class="modal-title" id="addTenantModalLabel">Add New Tenant</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">

                            <% if (error && error.length> 0) { %>
                                <div class="alert alert-danger" role="alert">
                                    <%= error %>
                                </div>
                                <% } %>

                                    <form action="/tenancy-manager/tenant/new" method="POST">
                                        <div class="row">
                                            <!-- Left Column -->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="tenantName">Tenant Name</label>
                                                    <input type="text" class="form-control" id="tenantName" name="name"
                                                        required>
                                                </div>
                                                <div class="form-group">
                                                    <label for="tenantEmail">Tenant Email</label>
                                                    <input type="email" class="form-control" id="tenantEmail"
                                                        name="email" required>
                                                </div>
                                                <div class="form-group">
                                                    <label for="tenantPhone">Tenant Phone Number</label>
                                                    <input type="text" class="form-control" id="tenantPhone"
                                                        name="phone" required>
                                                </div>
                                                <div class="form-group">
                                                    <label for="leaseStartDate">Lease Start Date</label>
                                                    <input type="date" class="form-control" id="leaseStartDate"
                                                        name="leaseStartDate" required>
                                                </div>
                                                <div class="form-group">
                                                    <label for="leaseEndDate">Lease End Date</label>
                                                    <input type="date" class="form-control" id="leaseEndDate"
                                                        name="leaseEndDate" required>
                                                </div>

                                            </div>

                                            <!-- Right Column -->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="tenantDoorNumber">Door Number</label>
                                                    <input type="text" class="form-control" id="tenantDoorNumber"
                                                        name="doorNumber" placeholder="e.g B-20" required>
                                                </div>

                                                <div class="form-group">
                                                    <label for="propertySelection">Property</label>
                                                    <select class="form-control" id="propertySelection" name="property"
                                                        required>
                                                        <option value="">Select Property</option>
                                                        <% properties.forEach(property=> { %>
                                                            <option value="<%= property._id %>">
                                                                <%= property.name %>
                                                            </option>
                                                            <% }); %>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="unitSelection">Unit</label>
                                                    <select class="form-control" id="unitSelection" name="unitId"
                                                        required>
                                                        <option value="">Select Unit</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="utilitiesAmount">Utilities</label>
                                                    <input type="number" class="form-control" id="utilitiesAmount"
                                                        name="utilities" required min="0" step="0.01" readonly>
                                                </div>
                                                <div class="form-group">
                                                    <label for="tenantRentPaid">Deposit</label>
                                                    <input type="number" class="form-control" id="tenantRentPaid"
                                                        name="deposit" required min="0" step="0.01" readonly>
                                                </div>
                                            </div>
                                        </div>
                                        <script>
                                            document.addEventListener('DOMContentLoaded', function () {
                                                const propertySelect = document.getElementById('propertySelection');
                                                const unitSelect = document.getElementById('unitSelection');
                                                const depositInput = document.getElementById('tenantRentPaid');
                                                const utilitiesInput = document.getElementById('utilitiesAmount');

                                                propertySelect.addEventListener('change', async function () {
                                                    const propertyId = this.value;

                                                    // Clear previous unit options and reset inputs
                                                    unitSelect.innerHTML = '<option value="">Select Unit</option>';
                                                    depositInput.value = '';
                                                    utilitiesInput.value = '';

                                                    if (propertyId) {
                                                        try {
                                                            // Adjusted API endpoint
                                                            const response = await fetch(`/tenancy-manager/units/${propertyId}`);

                                                            if (!response.ok) {
                                                                const errorData = await response.json();
                                                                throw new Error(`Failed to fetch units: ${response.statusText} - ${errorData.error || ''}`);
                                                            }

                                                            const units = await response.json();

                                                            // Check if the data structure is correct
                                                            if (Array.isArray(units) && units.length > 0) {
                                                                units.forEach(unit => {
                                                                    const option = document.createElement('option');
                                                                    option.value = unit._id;
                                                                    option.textContent = unit.unitType;
                                                                    option.dataset.deposit = unit.deposit || 0;
                                                                    const totalUtilities = (unit.utilities || []).reduce((sum, utility) => sum + utility.amount, 0);
                                                                    option.dataset.utilities = totalUtilities;

                                                                    unitSelect.appendChild(option);
                                                                });
                                                            } else {
                                                                console.warn('No units found or incorrect data structure:', units);
                                                                alert('No units found for the selected property.');
                                                            }
                                                        } catch (error) {
                                                            console.error('Error fetching units:', error);
                                                            alert(`Failed to fetch units. Error: ${error.message}`);
                                                        }
                                                    }
                                                });

                                                unitSelect.addEventListener('change', function () {
                                                    const selectedOption = this.options[this.selectedIndex];
                                                    const depositAmount = selectedOption?.dataset.deposit || 0;
                                                    const utilitiesAmount = selectedOption?.dataset.utilities || 0;
                                                    depositInput.value = depositAmount;
                                                    utilitiesInput.value = utilitiesAmount;
                                                });
                                            });

                                            // Change button to "Processing..." on form submission
                                            document.querySelector('form').addEventListener('submit', function (event) {
                                                const submitButton = this.querySelector('button[type="submit"]');
                                                submitButton.disabled = true;
                                                submitButton.textContent = 'Processing...';
                                            });
                                        </script>


                                        <button type="submit" class="btn btn-dark w-100"
                                            style="background-color: #003366; color: #ffffff;">Add Tenant</button>
                                    </form>
                        </div>
                    </div>
                </div>
            </div>


            <style>
                @media (max-width: 476px) {
                    .modal-content {
                        padding: 5px;
                    }

                    .modal-title {
                        font-size: 0.9rem;
                    }

                    .form-group label {
                        font-size: 0.6rem;
                    }

                    .form-control {
                        font-size: 0.6rem;
                    }

                    .btn {
                        font-size: 0.6rem;
                    }


                    .modal-dialog {
                        max-width: 100%;
                        max-height: fit-content;
                    }


                }
            </style>

            <!-- Toastr JS -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>



            <script>// Function for filtering tenants in the table
                document.getElementById('tenantSearch').addEventListener('input', function () {
                    const filter = this.value.toLowerCase();
                    const rows = document.querySelectorAll('table tbody tr');

                    // Loop through each row and toggle its visibility based on the search filter
                    rows.forEach(row => {
                        const tenantCells = row.querySelectorAll('td');
                        let rowVisible = false; // Track visibility state

                        // Check each cell's text against the filter
                        tenantCells.forEach(cell => {
                            if (cell.textContent.toLowerCase().includes(filter)) {
                                rowVisible = true; // Set to true if any cell matches
                            }
                        });

                        // Show or hide the row based on visibility state
                        row.style.display = rowVisible ? '' : 'none';
                    });
                });

                // Function to open Edit Modal and populate the fields with tenant data
                function openEditModal(id, name, email, phone) {
                    // Populate edit form fields
                    document.getElementById('tenantName').value = name;
                    document.getElementById('tenantEmail').value = email;
                    document.getElementById('tenantPhone').value = phone;

                    // Set form action dynamically to include tenant ID
                    document.getElementById('editTenantForm').action = `/tenancy-manager/tenants/edit/${id}`;

                    // Open the modal
                    $('#editTenantModal').modal('show');
                }

                // Function to open Delete Modal and show tenant name
                function openDeleteModal(id, name) {
                    // Set the tenant name in the confirmation message
                    document.getElementById('deleteTenantName').textContent = name;

                    // Set form action dynamically to include tenant ID
                    document.getElementById('deleteTenantForm').action = `/tenancy-manager/tenants/delete/${id}`;

                    // Open the modal
                    $('#deleteTenantModal').modal('show');
                }

                // Enable Bootstrap tooltips
                $(function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });
            </script>




            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
            </aside>
            <!-- /.control-sidebar -->

            <!-- Main Footer -->
            <footer class="main-footer">
                <strong>Copyright &copy; 2024-2025 <a href="https://leasecaptain.com/">Lease Captain</a></strong>
                All rights reserved.
                <div class="float-right d-none d-sm-inline-block">
                    <b>Version</b> 1.0.2
                </div>
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- REQUIRED SCRIPTS -->
        <!-- jQuery -->
        <script src="/plugins/jquery/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- overlayScrollbars -->
        <script src="/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
        <!-- AdminLTE App -->
        <script src="/dist/js/adminlte2167.js?v=3.2.0"></script>

        <!-- PAGE PLUGINS -->
        <!-- jQuery Mapael -->
        <script src="/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
        <script src="/plugins/raphael/raphael.min.js"></script>
        <script src="/plugins/jquery-mapael/jquery.mapael.min.js"></script>
        <script src="/plugins/jquery-mapael/maps/usa_states.min.js"></script>
        <!-- ChartJS -->
        <script src="/plugins/chart.js/Chart.min.js"></script>

        <!-- AdminLTE for demo purposes -->
        <script src="/dist/js/demo.js"></script>
        <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
        <script src="/dist/js/pages/dashboard2.js"></script>
</body>

<!-- Mirrored from adminlte.io/themes/v3/index2.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 29 Nov 2024 09:27:35 GMT -->

</html>
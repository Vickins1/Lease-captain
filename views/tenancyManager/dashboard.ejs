<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lease Captain | Dashboard</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&amp;display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/adminlte.min2167.css?v=3.2.0">
    <link rel="icon" type="image/png" sizes="56x56" href="/assets/images/1.png">
</head>

<body data-is-new-user="<%= isNewUser ? 'true' : 'false' %>"
    class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">

        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__wobble" src="/assets/images/2.png" alt="AdminLTELogo" height="150" width="150">
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Navbar Search -->
                <li class="nav-item">
                    <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                        <i class="fas fa-search"></i>
                    </a>
                    <div class="navbar-search-block">
                        <form class="form-inline">
                            <div class="input-group input-group-sm">
                                <input class="form-control form-control-navbar" type="search" placeholder="Search"
                                    aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-navbar" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>

                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge"></span>
                    </a>

                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
                <li class="nav-item ">
                    <a href="/logout" class="nav-link" role="button">
                        <i class="nav-icon fas fa-sign-out-alt"></i>
                    </a>
                </li>

            </ul>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-light-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/" class="brand-link">
                <img src="/assets/images/2.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
                    style="opacity: .8">
                <h4 class="brand-text font-weight-bold"><strong>Lease Captain</strong></h4>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="/dist/img/cap.png" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block" aria-haspopup="true" aria-expanded="false">
                            <span>Welcome back,</span><br>
                            <strong>
                                <%= currentUser.username %>
                            </strong>
                        </a>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                        <!-- Dashboard -->
                        <li class="nav-item">
                            <a href="/dashboard" class="nav-link active"
                                style="background-color: #003366; color: #ffffff;">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard</p>
                            </a>
                        </li>

                        <!-- Property Management -->
                        <li class="nav-header"><strong>PROPERTY MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/properties" class="nav-link">
                                <i class="nav-icon fas fa-building"></i>
                                <p>Properties</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/property/units" class="nav-link">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Property Units</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/propertyListing" class="nav-link">
                                <i class="nav-icon fas fa-list-alt"></i>
                                <p>List Properties</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon fas fa-chart-line"></i>
                                <p>
                                    Tenant Management
                                    <i class="right fas fa-angle-left"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="/tenancy-manager/tenants" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Tenants</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/maintenance-requests" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Maintenance Requests</p>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- Land Management -->
                        <li class="nav-header"><strong>LAND MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lands" class="nav-link">
                                <i class="nav-icon fas fa-map"></i>
                                <p>Registered Lands</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/land-parcels" class="nav-link">
                                <i class="nav-icon fas fa-th-large"></i>
                                <p>Land Parcels</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/land-reports" class="nav-link">
                                <i class="nav-icon fas fa-chart-area"></i>
                                <p>Land Reports</p>
                            </a>
                        </li>

                        <!-- Lease Management -->
                        <li class="nav-header"><strong>LEASE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/leases" class="nav-link">
                                <i class="nav-icon fas fa-file-contract"></i>
                                <p>Leases</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lease-templates" class="nav-link">
                                <i class="nav-icon fas fa-file-alt"></i>
                                <p>Lease Templates</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/lease-reports" class="nav-link">
                                <i class="nav-icon fas fa-chart-bar"></i>
                                <p>Lease Reports</p>
                            </a>
                        </li>

                        <!-- Vehicle Management -->
                        <li class="nav-header"><strong>VEHICLE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicles" class="nav-link">
                                <i class="nav-icon fas fa-car"></i>
                                <p>Registered Vehicles</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicle-parking" class="nav-link">
                                <i class="nav-icon fas fa-parking"></i>
                                <p>Parking Spaces</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/vehicle-reports" class="nav-link">
                                <i class="nav-icon fas fa-clipboard-list"></i>
                                <p>Vehicle Reports</p>
                            </a>
                        </li>

                        <!-- Finance -->
                        <li class="nav-header"><strong>FINANCE MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/payments" class="nav-link">
                                <i class="nav-icon fas fa-money-bill-wave"></i>
                                <p>Payment Transactions</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/reports-invoices" class="nav-link">
                                <i class="nav-icon fas fa-file-invoice"></i>
                                <p>Reports & Invoices</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/expenses" class="nav-link">
                                <i class="nav-icon fas fa-wallet"></i>
                                <p>Expense Tracking</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/budget-planning" class="nav-link">
                                <i class="nav-icon fas fa-chart-pie"></i>
                                <p>Budget Planning</p>
                            </a>
                        </li>

                        <!-- Notifications -->
                        <li class="nav-header"><strong>NOTIFICATION MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/sms&email" class="nav-link">
                                <i class="nav-icon fas fa-sms"></i>
                                <p>SMS & Email</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/sms&email" class="nav-link">
                                <i class="nav-icon fas fa-credit-card"></i>
                                <p>Credit Top-up</p>
                            </a>
                        </li>

                        <!-- Staff Management -->
                        <li class="nav-header"><strong>STAFF MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/staff-directory" class="nav-link">
                                <i class="nav-icon fas fa-user-tie"></i>
                                <p>Staff Directory</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/staff-attendance" class="nav-link">
                                <i class="nav-icon fas fa-calendar-check"></i>
                                <p>Attendance</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/staff-payroll" class="nav-link">
                                <i class="nav-icon fas fa-file-invoice-dollar"></i>
                                <p>Payroll</p>
                            </a>
                        </li>

                        <!-- Account Management -->
                        <li class="nav-header"><strong>ACCOUNT MANAGEMENT</strong></li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/profile" class="nav-link">
                                <i class="nav-icon fas fa-user"></i>
                                <p>Profile Settings</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenancy-manager/security" class="nav-link">
                                <i class="nav-icon fas fa-lock"></i>
                                <p>Security Settings</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/connect" class="nav-link">
                                <i class="nav-icon fas fa-link"></i>
                                <p>Payment Gateway</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/users" class="nav-link">
                                <i class="nav-icon fas fa-users"></i>
                                <p>User Accounts</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/upgrade-subscription" class="nav-link">
                                <i class="nav-icon fas fa-arrow-circle-up"></i>
                                <p>Upgrade Subscription</p>
                            </a>
                        </li>
                        <!-- Support -->
                        <li class="nav-item mt-auto">
                            <a href="/contacts" class="nav-link d-flex align-items-center justify-content-center"
                                style="background-color: #003366; color: #ffffff; border-radius: 5px; margin: 10px;">
                                <i class="fas fa-headset mr-2"></i>
                                <p>Support</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <script>
                class TourManager {
                    constructor() {
                        this.overlay = this.createOverlay();
                        this.currentStep = 0;
                        this.isTourActive = false;
                        this.sidebar = document.querySelector('.main-sidebar');
                        this.navContainer = document.querySelector('.nav-sidebar');

                        this.steps = [
                            {
                                target: '.nav-link[href="/dashboard"]',
                                title: ' Explore Your Dashboard',
                                content: 'The dashboard provides an overview of your properties, tenants, and financials, giving you quick insights at a glance.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/properties"]',
                                title: 'Add Your First Property',
                                content: 'Adding a property is the foundation of your rental management. It lets you organize all your units, tenants, and payments in one place.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/property/units"]',
                                title: ' Add Property Units',
                                content: 'Units help you break down your property into manageable parts, making it easier to assign tenants and track rent for each space.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/propertyListing"]',
                                title: ' List Your Properties',
                                content: 'Listing your properties attracts new tenants. Showcase your rentals here to fill vacancies faster.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/tenants"]',
                                title: ' Add Tenants',
                                content: 'Tenants are the heart of your business. Add them here to monitor leases, payments, and maintenance requests efficiently.'
                            },
                            {
                                target: '.nav-link[href="/maintenance-requests"]',
                                title: ' Handle Maintenance Requests',
                                content: 'Manage tenant maintenance requests here to keep your properties in top condition and ensure tenant satisfaction.'
                            },
                            {
                                target: '.nav-link[href="/connect"]',
                                title: ' Connect Payment Gateway',
                                content: 'Streamline rent collection by integrating a payment gateway. Follow these steps to enable STK Push: <br><br> 1. <strong>Sign Up</strong>: Create an account on <a href="https://portal.umeskiasoftwares.com" target="_blank">portal.umeskiasoftwares.com</a>.<br> 2. <strong>Register for UmsPay</strong>: Enroll in UmsPay via your dashboard.<br> 3. <strong>Connect Bank/Paybill/Till</strong>: Link your account.<br> 4. <strong>Connect API</strong>: Input your API key from the Developers section for seamless payments.<br><br>Contact support for guidance if you need assistance.'
                            },

                            {
                                target: '.nav-link[href="/tenancy-manager/payments"]',
                                title: ' Manage Payment Transactions',
                                content: 'Track and manage all payment transactions, monitor rent payments, issue receipts, and ensure financial transparency.'
                            },
                            {
                                target: '.nav-link[href="/reports-invoices"]',
                                title: ' Generate Reports & Invoices',
                                content: 'Create detailed financial reports and invoices to keep records organized and communicate payment details to tenants.'
                            },
                            {
                                target: '.nav-link[href="/expenses"]',
                                title: ' Track Expenses',
                                content: 'Monitor property-related expenses to maintain a clear overview of financial outflows and optimize your budget.'
                            },
                            {
                                target: '.nav-link[href="/budget-planning"]',
                                title: ' Plan Your Budget',
                                content: 'Use budget planning tools to forecast income and expenses, helping you make informed financial decisions.'
                            },
                            {
                                target: '.nav-link[href="/sms&email"]',
                                title: ' Send SMS & Email Notifications',
                                content: 'Communicate with tenants and staff via SMS and email to send reminders, updates, or important notices.'
                            },


                            {
                                target: '.nav-link[href="/users"]',
                                title: ' Manage User Accounts',
                                content: 'Add or manage additional user accounts for your team to collaborate on property management tasks.'
                            },
                            {
                                target: '.nav-link[href="/upgrade-subscription"]',
                                title: ' Upgrade Subscription',
                                content: 'Unlock advanced features and higher limits by upgrading your subscription plan.'
                            },
                            {
                                target: '.nav-link[href="/staff-directory"]',
                                title: ' Manage Staff Directory',
                                content: 'Keep track of your team by maintaining an organized staff directory with contact and role details.'
                            },
                            {
                                target: '.nav-link[href="/staff-attendance"]',
                                title: ' Track Staff Attendance',
                                content: 'Monitor staff attendance to ensure accountability and streamline workforce management.'
                            },
                            {
                                target: '.nav-link[href="/staff-payroll"]',
                                title: ' Handle Payroll',
                                content: 'Manage staff salaries and payments efficiently with the payroll system.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/profile"]',
                                title: ' Update Profile Settings',
                                content: 'Personalize your account by updating your profile settings, including contact information and preferences.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/security"]',
                                title: ' Secure Your Account',
                                content: 'Enhance your account security by managing passwords and other security settings here.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/lands"]',
                                title: ' Register Lands',
                                content: 'Track your land assets by registering them here, organizing ownership and usage details.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/land-parcels"]',
                                title: ' Manage Land Parcels',
                                content: 'Divide your land into parcels for better management and potential leasing or development.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/land-reports"]',
                                title: ' View Land Reports',
                                content: 'Generate reports to analyze your land assets, helping you make informed decisions.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/leases"]',
                                title: ' Create Leases',
                                content: 'Set up lease agreements for your tenants to formalize rental terms and ensure clarity.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/lease-templates"]',
                                title: ' Use Lease Templates',
                                content: 'Save time by creating reusable lease templates for consistent and efficient lease management.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/lease-reports"]',
                                title: ' Review Lease Reports',
                                content: 'Monitor lease performance and compliance with detailed reports to stay on top of your agreements.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/vehicles"]',
                                title: ' Register Vehicles',
                                content: 'Track vehicles associated with your properties, such as tenant or staff vehicles, for better management.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/vehicle-parking"]',
                                title: ' Assign Parking Spaces',
                                content: 'Organize parking spaces for tenants or visitors to streamline property access and avoid conflicts.'
                            },
                            {
                                target: '.nav-link[href="/tenancy-manager/vehicle-reports"]',
                                title: ' Check Vehicle Reports',
                                content: 'Review vehicle-related data to ensure compliance with parking rules and property policies.'
                            },

                        ];
                    }

                    createOverlay() {
                        const overlay = document.createElement('div');
                        overlay.className = 'tour-overlay';
                        document.body.appendChild(overlay);
                        return overlay;
                    }

                    async showStep(stepIndex) {
                        if (!this.isTourActive || stepIndex >= this.steps.length) {
                            await this.endTour();
                            return;
                        }

                        const step = this.steps[stepIndex];
                        const targetElement = document.querySelector(step.target);

                        if (!targetElement) {
                            console.warn(`Target element not found: ${step.target}`);
                            this.nextStep();
                            return;
                        }

                        // Expand parent treeview if target is in a submenu
                        const parentTreeview = targetElement.closest('.nav-treeview');
                        if (parentTreeview) {
                            const parentLink = parentTreeview.previousElementSibling;
                            if (parentLink && !parentLink.parentElement.classList.contains('menu-open')) {
                                parentLink.click(); // Trigger AdminLTE treeview expand
                            }
                        }

                        // Scroll the sidebar to the target
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

                        document.querySelectorAll('.tour-step').forEach(el => el.remove());
                        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

                        targetElement.classList.add('highlight');

                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'tour-step';
                        // Position at the right edge of the sidebar
                        const sidebarRect = this.sidebar.getBoundingClientRect();
                        stepDiv.style.position = 'fixed';
                        stepDiv.style.top = '20px'; // Fixed at top of viewport
                        stepDiv.style.left = `${sidebarRect.right + 10}px`; // Right edge of sidebar + 10px offset
                        stepDiv.style.width = '300px'; // Fixed width for consistency
                        stepDiv.style.zIndex = '2010';

                        stepDiv.innerHTML = `
                            <div class="tour-progress">Step ${stepIndex + 1} of ${this.steps.length}</div>
                            <h3>${step.title}</h3>
                            <p>${step.content}</p>
                            <div class="tour-buttons">
                                <button class="skip-btn">Skip Tour</button>
                                <button id="next-btn">
                                    ${stepIndex === this.steps.length - 1 ? 'Finish' : 'Next'}
                                </button>
                            </div>
                        `;

                        document.body.appendChild(stepDiv); // Append to body for fixed positioning
                        this.overlay.style.display = 'block';
                        this.overlay.style.zIndex = '1000';

                        const nextBtn = stepDiv.querySelector('#next-btn');
                        const skipBtn = stepDiv.querySelector('.skip-btn');
                        nextBtn.addEventListener('click', () => this.nextStep(), { once: true });
                        skipBtn.addEventListener('click', () => this.endTour(), { once: true });
                    }

                    nextStep() {
                        this.currentStep++;
                        this.showStep(this.currentStep);
                    }

                    async endTour() {
                        this.isTourActive = false;
                        this.overlay.style.display = 'none';
                        document.querySelectorAll('.tour-step').forEach(el => el.remove());
                        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

                        try {
                            const response = await fetch('/api/user/complete-tour', {
                                method: 'POST',
                                credentials: 'include',
                                headers: { 'Content-Type': 'application/json' }
                            });
                            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                            this.showCompletionMessage(true);
                        } catch (error) {
                            console.error('Tour completion error:', error);
                            this.showCompletionMessage(false);
                        }
                    }

                    showCompletionMessage(success) {
                        const message = success
                            ? 'Welcome aboard! You’re ready to manage your properties like a pro!'
                            : 'Tour ended, but we couldn’t save your progress. Contact support if needed.';
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'tour-alert';
                        alertDiv.textContent = message;
                        document.body.appendChild(alertDiv);
                        setTimeout(() => alertDiv.remove(), 5000);
                    }

                    async start() {
                        if (this.isTourActive) return;
                        this.isTourActive = true;

                        // Check if sidebar is collapsed or on mobile screen (<= 768px)
                        const isMobile = window.innerWidth <= 768;
                        if (isMobile || this.sidebar.classList.contains('sidebar-collapse')) {
                            const pushMenuButton = document.querySelector('[data-widget="pushmenu"]');
                            if (pushMenuButton) {
                                pushMenuButton.click(); // Open sidebar
                            }
                        }

                        this.showStep(this.currentStep);

                        window.addEventListener('resize', () => {
                            if (this.isTourActive) {
                                const stepDiv = document.querySelector('.tour-step');
                                if (stepDiv) {
                                    const sidebarRect = this.sidebar.getBoundingClientRect();
                                    stepDiv.style.left = `${sidebarRect.right + 10}px`; // Adjust on resize
                                }
                            }
                        });
                    }
                }

                document.addEventListener('DOMContentLoaded', () => {
                    const isNewUser = document.body.dataset.isNewUser === 'true';
                    if (isNewUser) {
                        const tour = new TourManager();
                        tour.start();
                    }
                });
            </script>

            <style>
                .tour-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 1000;
                    display: none;
                    transition: opacity 0.3s ease;
                }

                .tour-step {
                    background: #ffffff;
                    padding: 15px;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                    font-family: 'Source Sans Pro', sans-serif;
                    animation: fadeIn 0.5s ease-in-out;
                    border: 1px solid #003366;
                }

                .tour-progress {
                    font-size: 0.9em;
                    color: #666;
                    margin-bottom: 10px;
                }

                .tour-step h3 {
                    color: #003366;
                    margin: 0 0 10px 0;
                    font-size: 1.2em;
                    font-weight: 600;
                }

                .tour-step p {
                    margin: 0 0 12px 0;
                    color: #333;
                    line-height: 1.4;
                    font-size: 0.95em;
                }

                .tour-buttons {
                    display: flex;
                    gap: 10px;
                    justify-content: flex-end;
                    margin-top: 12px;
                }

                .tour-step button {
                    padding: 6px 16px;
                    border-radius: 5px;
                    border: none;
                    cursor: pointer;
                    font-size: 0.9em;
                    transition: all 0.3s ease;
                }

                .tour-step #next-btn {
                    background-color: #003366;
                    color: #fff;
                }

                .tour-step #next-btn:hover {
                    background-color: #0055a5;
                    transform: translateY(-2px);
                }

                .tour-step .skip-btn {
                    background-color: #f5f5f5;
                    color: #333;
                    border: 1px solid #ddd;
                }

                .tour-step .skip-btn:hover {
                    background-color: #e0e0e0;
                    transform: translateY(-2px);
                }

                .highlight {
                    position: relative;
                    z-index: 2005;
                    border: 3px solid #003366;
                    border-radius: 5px;
                    background: rgba(0, 51, 102, 0.1);
                    animation: pulse 1.5s infinite;
                    box-shadow: 0 0 10px rgba(0, 51, 102, 0.5);
                }

                .tour-alert {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: #003366;
                    color: #fff;
                    padding: 15px 25px;
                    border-radius: 5px;
                    z-index: 2020;
                    animation: slideIn 0.5s ease-in-out;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                @keyframes pulse {
                    0% {
                        box-shadow: 0 0 0 0 rgba(0, 51, 102, 0.7);
                    }

                    70% {
                        box-shadow: 0 0 0 15px rgba(0, 51, 102, 0);
                    }

                    100% {
                        box-shadow: 0 0 0 0 rgba(0, 51, 102, 0);
                    }
                }

                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateX(100%);
                    }

                    to {
                        opacity: 1;
                        transform: translateX(0);
                    }
                }

                @media (max-width: 991px) {
                    .tour-step {
                        padding: 10px;
                        font-size: 0.9em;
                        width: 250px;
                    }

                    .tour-step h3 {
                        font-size: 1.1em;
                    }

                    .tour-step button {
                        padding: 5px 12px;
                        font-size: 0.85em;
                    }
                }

                @media (max-width: 576px) {
                    .tour-step {
                        top: 10px !important;
                        left: 10px !important;
                        width: calc(100% - 20px) !important;
                        padding: 8px;
                    }

                    .tour-buttons {
                        flex-direction: column;
                        gap: 8px;
                    }

                    .tour-step button {
                        width: 100%;
                    }
                }
            </style>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <!-- Info Boxes (4 per row) -->
                    <div class="row mt-4 g-4">
                        <!-- Total Rent Collected -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Total Rent Collected</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-money-bill-wave mr-2"></i> Ksh. <%= Number(totalRentCollected ||
                                        0).toFixed(2) %>
                                </div>
                            </div>
                        </div>

                        <!-- Utility Paid -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Utility Paid</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-money-bill-alt mr-2"></i> Ksh. <%= Number(utilityCollected ||
                                        0).toFixed(2) %>
                                </div>
                            </div>
                        </div>

                        <!-- Total Rent Due -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Total Rent Due</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-calendar-times mr-2"></i> Ksh. <%= Number(totalRentDue ||
                                        0).toFixed(2) %>
                                </div>
                            </div>
                        </div>

                        <!-- Utility Due -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Utility Due</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-water mr-2"></i> Ksh. <%= Number(utilityDue || 0).toFixed(2) %>
                                </div>
                            </div>
                        </div>

                        <!-- Total Properties -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Total Properties</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-home mr-2"></i>
                                    <%= properties?.length || 0 %>
                                </div>
                            </div>
                        </div>

                        <!-- Number of Property Units -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Units</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-building mr-2"></i>
                                    <%= propertyUnits?.length || 0 %>
                                </div>
                            </div>
                        </div>

                        <!-- Number of Tenants -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Tenants</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-users mr-2"></i>
                                    <%= numberOfTenants || 0 %>
                                </div>
                            </div>
                        </div>

                        <!-- Maintenance Requests -->
                        <div class="col-6 col-md-3 mb-4">
                            <div class="card shadow-lg border-0">
                                <div class="card-header text-white">
                                    <h5>Maintenance Requests</h5>
                                </div>
                                <div class="card-body bold-text">
                                    <i class="fas fa-tools mr-2"></i>
                                    <%= totalRequests || 0 %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <style>
                        /* Info Boxes Styling */
                        .bold-text {
                            font-weight: bold;
                        }

                        .card {
                            border-radius: 0.2rem;
                            transition: transform 0.2s ease;
                            height: 150px;
                            width: 100%;
                            background-color: #fff;
                            overflow: hidden;
                            display: flex;
                            flex-direction: column;
                            box-sizing: border-box;
                        }

                        .card:hover {
                            transform: translateY(-5px);
                        }

                        .card-header {
                            background-color: #003366;
                            padding: 12px 15px;
                            border-top-left-radius: 0.2rem;
                            border-top-right-radius: 0.2rem;
                            height: 50px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-shrink: 0;
                        }

                        .card-header h5 {
                            margin: 0;
                            font-size: 1rem;
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            max-width: 100%;
                        }

                        .card-body {
                            padding: 15px;
                            font-size: 1.1rem;
                            color: #333;
                            flex-grow: 1;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                        }

                        .fas {
                            color: #003366;
                            margin-right: 10px;
                            font-size: 1.2rem;
                        }

                        @media (min-width: 768px) {
                            .col-md-3 {
                                flex: 0 0 25%;
                                max-width: 25%;
                            }
                        }

                        @media (max-width: 767.98px) {
                            .col-6 {
                                flex: 0 0 50%;
                                max-width: 50%;
                            }

                            .card {
                                height: 140px;
                            }

                            .card-header {
                                height: 45px;
                            }

                            .card-header h5 {
                                font-size: 0.95rem;
                            }

                            .card-body {
                                font-size: 1rem;
                            }

                            .fas {
                                font-size: 1.1rem;
                            }
                        }

                        @media (max-width: 400px) {
                            .col-6 {
                                flex: 0 0 50%;
                                /* Fixed: Keep 2-per-row, not 100% */
                                max-width: 50%;
                            }

                            .card {
                                height: 130px;
                            }

                            .card-header {
                                height: 40px;
                            }

                            .card-header h5 {
                                font-size: 0.9rem;
                            }

                            .card-body {
                                font-size: 0.95rem;
                            }

                            .fas {
                                font-size: 1rem;
                            }
                        }
                    </style>

                    <!-- Main row -->
                    <div class="row">
                        <div class="col-md-12">
                            <!-- TABLE: LATEST PAYMENTS -->
                            <div class="latest-payments">
                                <div class="header text-white" style="background-color: #003366;">
                                    <h3 class="title">Latest Payments</h3>
                                    <div class="tools">
                                        <button type="button" class="btn btn-tool" data-widget="collapse">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button type="button" class="btn btn-tool" data-widget="remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="body p-0">
                                    <div class="table-responsive">
                                        <table class="table m-0">
                                            <thead>
                                                <tr>
                                                    <th>Transaction ID</th>
                                                    <th>Tenant</th>
                                                    <th>Status</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% if (payments && payments.length> 0) { %>
                                                    <% payments.forEach(payment=> { %>
                                                        <tr>
                                                            <td>
                                                                <a href="/tenancy-manager/payments/<%= payment._id %>"
                                                                    class="payment-id">
                                                                    <%= payment.transactionId || 'N/A' %>
                                                                </a>
                                                            </td>
                                                            <td class="tenant-info">
                                                                <%= payment.tenant?.name || payment.tenantName
                                                                    || 'Unknown Tenant' %>
                                                                    (<%= payment.property?.name || 'Unknown Property' %>
                                                                        - <%= payment.unit?.unitType ||
                                                                            payment.doorNumber || 'N/A' %>)
                                                            </td>
                                                            <td>
                                                                <span class="<%= payment.status === 'completed' ? 'text-success' : 
                                            payment.status === 'pending' ? 'text-warning' : 
                                            payment.status === 'failed' ? 'text-danger' : 'text-secondary' %>">
                                                                    <i
                                                                        class="fas <%= payment.status === 'completed' ? 'fa-check-circle' : 
                                                payment.status === 'pending' ? 'fa-hourglass-half' : 
                                                payment.status === 'failed' ? 'fa-times-circle' : 'fa-question-circle' %>"></i>
                                                                    <%= payment.status ?
                                                                        payment.status.charAt(0).toUpperCase() +
                                                                        payment.status.slice(1) : 'Unknown' %>
                                                                </span>
                                                            </td>
                                                            <td>
                                                                Ksh. <%= payment.amount ?
                                                                    Number(payment.amount).toLocaleString('en-KE', {
                                                                    minimumFractionDigits: 2, maximumFractionDigits: 2
                                                                    }) : '0.00' %>
                                                            </td>
                                                        </tr>
                                                        <% }); %>
                                                            <% } else { %>
                                                                <tr>
                                                                    <td colspan="4" class="text-center text-muted">No
                                                                        recent payments found.</td>
                                                                </tr>
                                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="footer clearfix">
                                    <a href="/tenancy-manager/payments" class="btn btn-sm btn-info float-right">View All
                                        Payments</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Recap Report -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="monthly-recap shadow-lg">
                                <div class="header text-white" style="background-color: #003366;">
                                    <h5 class="title">Monthly Recap Report</h5>
                                    <div class="tools">
                                        <button type="button" class="btn btn-tool" data-widget="collapse">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-tool dropdown-toggle"
                                                data-toggle="dropdown">
                                                <i class="fas fa-wrench"></i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right" role="menu">
                                                <a href="#" class="dropdown-item" id="export-pdf">Export to PDF</a>
                                                <a href="#" class="dropdown-item" id="export-csv">Export to CSV</a>
                                                <a href="#" class="dropdown-item">View Detailed Report</a>
                                                <div class="dropdown-divider"></div>
                                                <a href="#" class="dropdown-item" id="refresh-data">Refresh Data</a>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-tool" data-widget="remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="body p-3">
                                    <p class="text-center performance-text mb-3">
                                        <strong>Performance: 1 Jan, <%= new Date().getFullYear() %> - 31 Dec, <%= new
                                                    Date().getFullYear() %></strong>
                                    </p>
                                    <div class="chart-container" style="position: relative; height: 300px; width: 100%;"
                                        data-rent-data="<%= JSON.stringify(rentDataArray) %>">
                                        <canvas id="rentUtilityChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Include Chart.js -->
                    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
                    <script>
                        // Retrieve initial data from data attribute
                        const chartContainer = document.querySelector('.chart-container');
                        const rentDataArray = JSON.parse(chartContainer.getAttribute('data-rent-data'));
                        const months = rentDataArray.map(data => data.month);
                        const rentPaid = rentDataArray.map(data => data.rentPaid);
                        const utilityPaid = rentDataArray.map(data => data.utilityPaid);

                        // Chart.js configuration
                        const ctx = document.getElementById('rentUtilityChart').getContext('2d');
                        const rentUtilityChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: months,
                                datasets: [
                                    {
                                        label: 'Rent Paid (Ksh)',
                                        data: rentPaid,
                                        borderColor: '#003366',
                                        backgroundColor: 'rgba(0, 51, 102, 0.2)',
                                        fill: true,
                                        tension: 0.4,
                                        pointBackgroundColor: '#003366',
                                        pointBorderColor: '#fff',
                                        pointHoverBackgroundColor: '#fff',
                                        pointHoverBorderColor: '#003366'
                                    },
                                    {
                                        label: 'Utility Paid (Ksh)',
                                        data: utilityPaid,
                                        borderColor: '#28a745',
                                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                                        fill: true,
                                        tension: 0.4,
                                        pointBackgroundColor: '#28a745',
                                        pointBorderColor: '#fff',
                                        pointHoverBackgroundColor: '#fff',
                                        pointHoverBorderColor: '#28a745'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Amount (Ksh)'
                                        },
                                        ticks: {
                                            callback: function (value) {
                                                return 'Ksh. ' + value.toLocaleString('en-KE');
                                            }
                                        }
                                    },
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Month'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                return `${context.dataset.label}: Ksh. ${context.parsed.y.toLocaleString('en-KE')}`;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Real-time update function (polling every 10 seconds)
                        function updateChart() {
                            fetch('/tenancy-manager/dashboard/rent-data', {
                                method: 'GET',
                                headers: { 'Accept': 'application/json' }
                            })
                                .then(response => response.json())
                                .then(data => {
                                    const newRentPaid = data.rentDataArray.map(d => d.rentPaid);
                                    const newUtilityPaid = data.rentDataArray.map(d => d.utilityPaid);
                                    rentUtilityChart.data.datasets[0].data = newRentPaid;
                                    rentUtilityChart.data.datasets[1].data = newUtilityPaid;
                                    rentUtilityChart.update();
                                })
                                .catch(err => console.error('Error updating chart:', err));
                        }

                        // Start polling
                        setInterval(updateChart, 10000); // Update every 10 seconds

                        // Manual refresh button
                        document.getElementById('refresh-data').addEventListener('click', (e) => {
                            e.preventDefault();
                            updateChart();
                        });

                        // Export to CSV
                        document.getElementById('export-csv').addEventListener('click', (e) => {
                            e.preventDefault();
                            const csvContent = "data:text/csv;charset=utf-8," +
                                "Month,Rent Paid (Ksh),Utility Paid (Ksh)\n" +
                                rentDataArray.map(d => `${d.month},${d.rentPaid},${d.utilityPaid}`).join("\n");
                            const encodedUri = encodeURI(csvContent);
                            const link = document.createElement("a");
                            link.setAttribute("href", encodedUri);
                            link.setAttribute("download", `rent_utility_paid_${new Date().getFullYear()}.csv`);
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        });

                        // Export to PDF (placeholder for jsPDF)
                        document.getElementById('export-pdf').addEventListener('click', (e) => {
                            e.preventDefault();
                            alert('PDF export requires jsPDF library integration.');
                            // Example with jsPDF (uncomment if included):
                            // const { jsPDF } = window.jspdf;
                            // const doc = new jsPDF();
                            // doc.text("Monthly Rent and Utility Paid", 10, 10);
                            // doc.autoTable({
                            //     head: [['Month', 'Rent Paid (Ksh)', 'Utility Paid (Ksh)']],
                            //     body: rentDataArray.map(d => [d.month, d.rentPaid, d.utilityPaid])
                            // });
                            // doc.save(`rent_utility_paid_${new Date().getFullYear()}.pdf`);
                        });
                    </script>

                    <style>
                        /* General Container Styling */
                        .monthly-recap {
                            border-radius: 0.25rem;
                            overflow: hidden;
                            background: #fff;
                        }

                        .header {
                            padding: 10px 15px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            background-color: #003366;
                        }

                        .title {
                            margin: 0;
                            font-size: 1.25rem;
                        }

                        .tools .btn-tool {
                            color: #fff;
                            padding: 5px;
                        }

                        .body {
                            padding: 0;
                        }

                        /* Table Styling */
                        .table-responsive {
                            overflow-x: auto;
                            -webkit-overflow-scrolling: touch;
                        }

                        .table {
                            width: 100%;
                            margin-bottom: 0;
                        }

                        .table th,
                        .table td {
                            padding: 12px;
                            vertical-align: middle;
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                        }

                        .table th {
                            background-color: #f8f9fa;
                            color: #333;
                        }

                        .performance-text {
                            font-size: 1.1rem;
                            color: #333;
                        }

                        /* Trend Chart Styling */
                        .trend-chart {
                            display: inline-block;
                            vertical-align: middle;
                        }

                        /* Responsive Adjustments */
                        @media (max-width: 768px) {
                            .title {
                                font-size: 1.1rem;
                            }

                            .table th,
                            .table td {
                                padding: 8px;
                                font-size: 0.9rem;
                            }

                            .performance-text {
                                font-size: 1rem;
                            }

                            .trend-chart {
                                width: 80px !important;
                                height: 35px !important;
                            }
                        }

                        @media (max-width: 576px) {
                            .header {
                                flex-direction: column;
                                align-items: flex-start;
                                padding: 8px 10px;
                            }

                            .title {
                                font-size: 1rem;
                                margin-bottom: 5px;
                            }

                            .tools {
                                flex-direction: row;
                                justify-content: flex-end;
                                width: 100%;
                                gap: 5px;
                            }

                            .table th,
                            .table td {
                                padding: 6px;
                                font-size: 0.85rem;
                            }

                            .performance-text {
                                font-size: 0.9rem;
                            }

                            .trend-chart {
                                width: 60px !important;
                                height: 30px !important;
                            }

                            .btn-group .dropdown-menu {
                                min-width: 120px;
                                font-size: 0.85rem;
                            }
                        }
                    </style>

                </div>
            </section>

        </div>
        <!-- /.content-wrapper -->

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->

        <!-- Main Footer -->
        <footer class="main-footer">
            <strong>Copyright &copy; 2024-2025 <a href="https://leasecaptain.com/">Lease Captain</a></strong>
            All rights reserved.
            <div class="float-right d-none d-sm-inline-block">
                <b>Version</b> 1.0.2
            </div>
        </footer>

    </div>
    <!-- ./wrapper -->



    <!-- REQUIRED SCRIPTS -->
    <!-- Bootstrap JS (including Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- overlayScrollbars -->
    <script src="/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/dist/js/adminlte2167.js?v=3.2.0"></script>

    <!-- PAGE PLUGINS -->
    <!-- jQuery Mapael -->
    <script src="/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
    <script src="/plugins/raphael/raphael.min.js"></script>
    <script src="/plugins/jquery-mapael/jquery.mapael.min.js"></script>
    <script src="/plugins/jquery-mapael/maps/usa_states.min.js"></script>
    <!-- ChartJS -->
    <script src="/plugins/chart.js/Chart.min.js"></script>

    <script src="/dist/js/demo.js"></script>
    <script src="/dist/js/pages/dashboard2.js"></script>
</body>

</html>
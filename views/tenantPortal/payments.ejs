<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lease Captain | Tenant Portal</title>
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/dist/css/adminlte.min2167.css?v=3.2.0">
    <!-- Custom Styles -->
    <link rel="icon" type="image/png" sizes="56x56" href="/assets/images/1.png">
</head>

<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">
        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__wobble" src="/assets/images/2.png" alt="LeaseCaptainLogo" height="150" width="150">
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-light" style="padding: 0.8rem 1.5rem;">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto align-items-center">
                <li class="nav-item dropdown mr-3">
                    <a class="nav-link" data-toggle="dropdown" href="#" style="display: flex; align-items: center;">
                        <i class="far fa-user mr-2"></i>
                        <% if (tenant) { %>
                            Welcome, <%= tenant.name %>
                        <% } else { %>
                            Welcome, Guest
                        <% } %>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right shadow-sm">
                        <a href="/tenantPortal/logout" class="dropdown-item">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-light-primary elevation-4">
            <a href="/tenantPortal/dashboard" class="brand-link">
                <img src="/assets/images/2.png" alt="LeaseCaptain Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                <h4 class="brand-text font-weight-bold"><strong>Tenant Portal</strong></h4>
            </a>
            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="/dist/img/cap.png" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">
                            <strong>
                                <% if (tenant) { %>
                                    <%= tenant.name %>
                                <% } else { %>
                                    Guest
                                <% } %>
                            </strong>
                        </a>
                    </div>
                </div>
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <li class="nav-item">
                            <a href="/tenantPortal/dashboard" class="nav-link active" style="background-color: #003366; color: #ffffff;">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/payments" class="nav-link">
                                <i class="nav-icon fas fa-money-bill-wave"></i>
                                <p>Payments</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/requestMaintenance" class="nav-link">
                                <i class="nav-icon fas fa-wrench"></i>
                                <p>Maintenance</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/lease" class="nav-link">
                                <i class="nav-icon fas fa-file-contract"></i>
                                <p>Lease</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenant/agreement" class="nav-link">
                                <i class="nav-icon fas fa-hourglass-half"></i>
                                <p>Agreement</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/tenant/profile" class="nav-link">
                                <i class="nav-icon fas fa-user"></i>
                                <p>Profile</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <div class="container-fluid mt-3">
                <section class="content">
                    <div class="container-fluid">
                        <% if (error && error.length > 0) { %>
                            <div class="alert alert-danger text-center" role="alert">
                                <%= error %>
                            </div>
                        <% } %>
                        <% if (success && success.length > 0) { %>
                            <div class="alert alert-success text-center" role="alert">
                                <%= success %>
                            </div>
                        <% } %>
                
                        <!-- Payment Section -->
                        <div class="card mt-4">
                            <div class="card-header" style="background-color: #003366; color: #ffffff;">
                                <h5 class="mb-2">Payment History</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm" id="paymentHistoryTable">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Date Paid</th>
                                                <th>Transaction ID</th>
                                                <th>Payment Type</th>
                                                <th>Amount Paid</th>
                                                <th>Payment Method</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% if (!payments || payments.length === 0) { %>
                                                <tr>
                                                    <td colspan="8" class="text-center">No payment records found.</td>
                                                </tr>
                                            <% } else { %>
                                                <% payments.forEach((payment, index) => { %>
                                                    <tr>
                                                        <td><%= (index + 1) + ((currentPage - 1) * perPage) %></td>
                                                        <td><%= payment.datePaid ? new Date(payment.datePaid).toLocaleString('en-GB') : 'N/A' %></td>
                                                        <td><%= payment.transactionId || 'N/A' %></td>
                                                        <td><%= payment.paymentType || 'N/A' %></td>
                                                        <td>Ksh. <%= Number(payment.totalPaid || 0).toFixed(2) %></td>
                                                        <td><%= payment.method || 'N/A' %></td>
                                                        <td>
                                                            <span class="badge <%= 
                                                                payment.status === 'completed' ? 'bg-success' : 
                                                                payment.status === 'pending' ? 'bg-warning' : 
                                                                payment.status === 'failed' ? 'bg-danger' : 'bg-secondary' %>">
                                                                <i class="fas <%= 
                                                                    payment.status === 'completed' ? 'fa-check-circle' : 
                                                                    payment.status === 'pending' ? 'fa-hourglass-half' : 
                                                                    payment.status === 'failed' ? 'fa-times-circle' : 'fa-question-circle' %>">
                                                                </i>
                                                                <%= payment.status || 'Unknown' %>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <a href="/download-receipt/<%= payment._id %>" class="text-primary" title="Download Receipt">
                                                                <i class="fas fa-download"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                <% }) %>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                
                                <!-- Pagination Controls -->
                                <div class="d-flex justify-content-between mt-3">
                                    <div>
                                        <p>Showing <%= ((currentPage - 1) * perPage + 1) %> to 
                                            <%= Math.min(currentPage * perPage, totalPayments) %> of <%= totalPayments %> payments</p>
                                    </div>
                                    <div>
                                        <% if (currentPage > 1) { %>
                                            <a href="/payments?page=<%= currentPage - 1 %>" class="btn btn-secondary mr-2">Previous</a>
                                        <% } %>
                                        <% for (let i = 1; i <= totalPages; i++) { %>
                                            <a href="/payments?page=<%= i %>" 
                                                class="btn <%= currentPage === i ? 'btn-primary' : 'btn-secondary' %> mr-1">
                                                <%= i %>
                                            </a>
                                        <% } %>
                                        <% if (currentPage < totalPages) { %>
                                            <a href="/payments?page=<%= currentPage + 1 %>" class="btn btn-secondary">Next</a>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Payment Buttons -->
                        <div class="row mt-3">
                            <div class="col-12 col-md-6 mb-2">
                                <button class="btn btn-primary btn-block" data-toggle="modal" data-target="#rentPaymentModal">
                                    <i class="fas fa-plus"></i> Make Rent Payment
                                </button>
                            </div>
                            <div class="col-12 col-md-6 mb-2">
                                <button class="btn btn-primary btn-block" data-toggle="modal" data-target="#utilityPaymentModal">
                                    <i class="fas fa-plus"></i> Make Utility Payment
                                </button>
                            </div>
                        </div>
                
                        <!-- Rent Payment Modal -->
                        <div class="modal fade" id="rentPaymentModal" tabindex="-1" role="dialog" aria-labelledby="rentPaymentModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content sleek-modal">
                                    <div class="modal-header" style="background-color: #003366; color: #ffffff; border-radius: 10px 10px 0 0;">
                                        <h5 class="modal-title" id="rentPaymentModalLabel">Make Rent Payment</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                    </div>
                                    <div class="modal-body p-4">
                                        <form id="rentPaymentForm" novalidate>
                                            <div class="form-group">
                                                <label for="rentAmount">Payment Amount</label>
                                                <input type="number" class="form-control sleek-input" id="rentAmount" name="amount" placeholder="Enter amount (e.g., 5000)" step="0.01" min="0" required>
                                                <small class="form-text text-muted">Enter the rent amount in Ksh.</small>
                                                <div class="invalid-feedback">Please enter a valid amount (e.g., 5000).</div>
                                            </div>
                                            <div class="form-group">
                                                <label for="rentPaymentMethod">Payment Method</label>
                                                <select class="form-control sleek-input" id="rentPaymentMethod" name="paymentMethod" required>
                                                    <option value="">Select Payment Method</option>
                                                    <option value="mobilePayment">Mobile Payment</option>
                                                </select>
                                                <small class="form-text text-muted">Choose how you'd like to pay.</small>
                                                <div class="invalid-feedback">Please select a payment method.</div>
                                            </div>
                                            <div class="form-group" id="rentPhoneGroup" style="display: none;">
                                                <label for="rentPhoneNumber">Phone Number</label>
                                                <input type="tel" class="form-control sleek-input" id="rentPhoneNumber" name="phoneNumber" placeholder="e.g., 0787654321" pattern="^0\d{9}$" required>
                                                <small class="form-text text-muted">Use format: 0787654321</small>
                                                <div class="invalid-feedback">Please enter a valid phone number (e.g., 0787654321).</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-block sleek-btn" id="rentSubmitButton">Pay Rent</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Rent Loader Modal -->
                        <div class="modal fade" id="rentLoaderModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content sleek-modal">
                                    <div class="modal-body p-4 text-center" id="rentLoaderModalBody">
                                        <!-- Dynamic content will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Utility Payment Modal -->
                        <div class="modal fade" id="utilityPaymentModal" tabindex="-1" role="dialog" aria-labelledby="utilityPaymentModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content sleek-modal">
                                    <div class="modal-header" style="background-color: #003366; color: #ffffff; border-radius: 10px 10px 0 0;">
                                        <h5 class="modal-title" id="utilityPaymentModalLabel">Make Utility Payment</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                    </div>
                                    <div class="modal-body p-4">
                                        <form id="utilityPaymentForm" novalidate>
                                            <div class="form-group">
                                                <label for="utilityAmount">Utility Amount</label>
                                                <input type="number" class="form-control sleek-input" id="utilityAmount" name="amount" placeholder="Enter amount (e.g., 1000)" step="0.01" min="0" required>
                                                <small class="form-text text-muted">Enter the utility amount in Ksh.</small>
                                                <div class="invalid-feedback">Please enter a valid amount (e.g., 1000).</div>
                                            </div>
                                            <div class="form-group">
                                                <label for="utilityPaymentMethod">Payment Method</label>
                                                <select class="form-control sleek-input" id="utilityPaymentMethod" name="paymentMethod" required>
                                                    <option value="">Select Payment Method</option>
                                                    <option value="mobilePayment">Mobile Payment</option>
                                                </select>
                                                <small class="form-text text-muted">Choose how you'd like to pay.</small>
                                                <div class="invalid-feedback">Please select a payment method.</div>
                                            </div>
                                            <div class="form-group" id="utilityPhoneGroup" style="display: none;">
                                                <label for="utilityPhoneNumber">Phone Number</label>
                                                <input type="tel" class="form-control sleek-input" id="utilityPhoneNumber" name="phoneNumber" placeholder="e.g., 0787654321" pattern="^0\d{9}$" required>
                                                <small class="form-text text-muted">Use format: 0787654321</small>
                                                <div class="invalid-feedback">Please enter a valid phone number (e.g., 0787654321).</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-block sleek-btn" id="utilitySubmitButton">Pay Utility</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Utility Loader Modal -->
                        <div class="modal fade" id="utilityLoaderModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content sleek-modal">
                                    <div class="modal-body p-4 text-center" id="utilityLoaderModalBody">
                                        <!-- Dynamic content will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Custom Styles (unchanged) -->
                        <style>
                            .btn-primary {
                                background-color: #003366;
                                border-color: #003366;
                            }
                            .btn-primary:hover {
                                background-color: #002244;
                                border-color: #002244;
                            }
                            .sleek-modal {
                                border-radius: 10px;
                                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
                                background: linear-gradient(135deg, #ffffff, #f8f9fa);
                            }
                            .modal-header {
                                border-bottom: none;
                                padding: 1.5rem 2rem;
                            }
                            .modal-header .close {
                                color: #ffffff;
                                font-size: 1.5rem;
                                opacity: 1;
                                text-shadow: none;
                            }
                            .modal-header .close:hover {
                                color: #ddd;
                            }
                            .sleek-input {
                                border-radius: 8px;
                                border: 1px solid #ced4da;
                                padding: 0.75rem 1rem;
                                transition: border-color 0.3s ease, box-shadow 0.3s ease;
                            }
                            .sleek-input:focus {
                                border-color: #003366;
                                box-shadow: 0 0 5px rgba(0, 51, 102, 0.5);
                            }
                            .sleek-btn {
                                border-radius: 8px;
                                padding: 0.75rem;
                                font-weight: 600;
                                background-color: #003366;
                                border: none;
                                transition: background-color 0.3s ease, transform 0.2s ease;
                            }
                            .sleek-btn:hover {
                                background-color: #002244;
                                transform: translateY(-2px);
                            }
                            .loader {
                                width: 40px;
                                height: 40px;
                                border: 4px solid #f3f3f3;
                                border-top: 4px solid #003366;
                                border-radius: 50%;
                                animation: spin 1s linear infinite;
                                margin: 0 auto;
                            }
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                            @media (max-width: 576px) {
                                .modal-body {
                                    padding: 1rem !important;
                                }
                            }
                        </style>
                
                        <!-- JavaScript (unchanged except for updatePaymentHistory) -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const rentPaymentMethod = document.getElementById('rentPaymentMethod');
                                const utilityPaymentMethod = document.getElementById('utilityPaymentMethod');
                                const rentPhoneGroup = document.getElementById('rentPhoneGroup');
                                const utilityPhoneGroup = document.getElementById('utilityPhoneGroup');
                                const rentForm = document.getElementById('rentPaymentForm');
                                const utilityForm = document.getElementById('utilityPaymentForm');
                                const rentSubmitButton = document.getElementById('rentSubmitButton');
                                const utilitySubmitButton = document.getElementById('utilitySubmitButton');
                
                                const rentModal = $('#rentPaymentModal');
                                const utilityModal = $('#utilityPaymentModal');
                                const rentLoaderModal = $('#rentLoaderModal');
                                const utilityLoaderModal = $('#utilityLoaderModal');
                
                                rentPaymentMethod.addEventListener('change', function () {
                                    rentPhoneGroup.style.display = this.value === 'mobilePayment' ? 'block' : 'none';
                                    document.getElementById('rentPhoneNumber').required = this.value === 'mobilePayment';
                                });
                
                                utilityPaymentMethod.addEventListener('change', function () {
                                    utilityPhoneGroup.style.display = this.value === 'mobilePayment' ? 'block' : 'none';
                                    document.getElementById('utilityPhoneNumber').required = this.value === 'mobilePayment';
                                });
                
                                function showLoaderModal(loaderModal, form, button, message) {
                                    button.disabled = true;
                                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                                    form.style.opacity = '0.5';
                                    loaderModal.find('.modal-body').html(`
                                        <div class="loader"></div>
                                        <p class="mt-3">${message}</p>
                                    `);
                                    loaderModal.modal('show');
                                }
                
                                function updateLoaderModalMessage(loaderModal, message, status) {
                                    const iconMap = {
                                        'pending': '<i class="fas fa-spinner fa-spin text-primary status-icon"></i>',
                                        'completed': '<i class="fas fa-check-circle text-success status-icon"></i>',
                                        'failed': '<i class="fas fa-exclamation-circle text-danger status-icon"></i>',
                                        'timeout': '<i class="fas fa-clock text-warning status-icon"></i>',
                                        'error': '<i class="fas fa-exclamation-circle text-danger status-icon"></i>'
                                    };
                                    loaderModal.find('.modal-body').html(`
                                        ${iconMap[status] || '<div class="loader"></div>'}<br>
                                        <span class="mt-3">${message}</span>
                                    `);
                                }
                
                                function resetLoaderModal(loaderModal, form, button, originalText) {
                                    button.disabled = false;
                                    button.innerHTML = originalText;
                                    form.style.opacity = '1';
                                    loaderModal.modal('hide');
                                }
                
                                function pollPaymentStatus(transactionId, loaderModal, form, button, originalText, endpoint) {
                                    const pollingInterval = 3000;
                                    const pollingTimeout = 65000;
                                    let pollingAttempts = 0;
                                    const maxAttempts = Math.floor(pollingTimeout / pollingInterval);
                
                                    const poll = setInterval(function() {
                                        $.ajax({
                                            url: `/payment-status?transactionId=${encodeURIComponent(transactionId)}`,
                                            method: 'GET',
                                            success: function(response) {
                                                updateLoaderModalMessage(loaderModal, response.message, response.status);
                                                if (['completed', 'failed', 'timeout'].includes(response.status)) {
                                                    clearInterval(poll);
                                                    setTimeout(function() {
                                                        resetLoaderModal(loaderModal, form, button, originalText);
                                                        window.location.reload(); // Reload to reflect new payment
                                                    }, 4000);
                                                }
                                            },
                                            error: function(xhr) {
                                                clearInterval(poll);
                                                updateLoaderModalMessage(loaderModal, 'Error checking payment status. Reloading in 4 seconds...', 'error');
                                                setTimeout(function() {
                                                    resetLoaderModal(loaderModal, form, button, originalText);
                                                    window.location.href = '/payments';
                                                }, 4000);
                                            }
                                        });
                
                                        pollingAttempts++;
                                        if (pollingAttempts >= maxAttempts) {
                                            clearInterval(poll);
                                            updateLoaderModalMessage(loaderModal, 'Payment status check timed out. Reloading in 4 seconds...', 'timeout');
                                            setTimeout(function() {
                                                resetLoaderModal(loaderModal, form, button, originalText);
                                                window.location.href = '/payments';
                                            }, 4000);
                                        }
                                    }, pollingInterval);
                                }
                
                                function handlePaymentSubmission(event, form, endpoint, loaderModal, button, originalText) {
                                    event.preventDefault();
                
                                    if (!form.checkValidity()) {
                                        form.classList.add('was-validated');
                                        return;
                                    }
                
                                    const formData = new FormData(form);
                                    const msisdn = formData.get('phoneNumber');
                                    const amount = parseFloat(formData.get('amount'));
                
                                    const phoneRegex = /^0\d{9}$/;
                                    if (!phoneRegex.test(msisdn)) {
                                        alert('Please enter a valid 10-digit phone number starting with 0 (e.g., 0787654321).');
                                        return;
                                    }
                
                                    if (isNaN(amount) || amount <= 0) {
                                        alert('Please enter a valid payment amount.');
                                        return;
                                    }
                
                                    const payload = {
                                        msisdn,
                                        amount,
                                        paymentType: endpoint.includes('rent') ? 'rent' : 'utility'
                                    };
                
                                    showLoaderModal(loaderModal, form, button, 'Initiating payment, please wait...');
                
                                    $.ajax({
                                        url: endpoint,
                                        method: 'POST',
                                        data: JSON.stringify(payload),
                                        contentType: 'application/json',
                                        success: function(response) {
                                            if (response.transactionId) {
                                                updateLoaderModalMessage(loaderModal, 'Payment request initiated successfully! Please enter your Mpesa PIN...', 'pending');
                                                pollPaymentStatus(response.transactionId, loaderModal, form, button, originalText, endpoint);
                                            } else {
                                                updateLoaderModalMessage(loaderModal, response.message || 'Failed to initiate payment. Reloading in 4 seconds...', 'failed');
                                                setTimeout(function() {
                                                    resetLoaderModal(loaderModal, form, button, originalText);
                                                    window.location.href = '/payments';
                                                }, 4000);
                                            }
                                        },
                                        error: function(xhr) {
                                            updateLoaderModalMessage(loaderModal, xhr.responseJSON?.message || 'Failed to initiate payment. Reloading in 4 seconds...', 'failed');
                                            setTimeout(function() {
                                                resetLoaderModal(loaderModal, form, button, originalText);
                                                window.location.href = '/payments';
                                            }, 4000);
                                        }
                                    });
                                }
                
                                rentForm.addEventListener('submit', function (e) {
                                    handlePaymentSubmission(e, rentForm, '/payment/rent', rentLoaderModal, rentSubmitButton, 'Pay Rent');
                                });
                
                                utilityForm.addEventListener('submit', function (e) {
                                    handlePaymentSubmission(e, utilityForm, '/payment/utility', utilityLoaderModal, utilitySubmitButton, 'Pay Utility');
                                });
                
                                rentModal.on('hidden.bs.modal', function () {
                                    resetLoaderModal(rentLoaderModal, rentForm, rentSubmitButton, 'Pay Rent');
                                    rentForm.classList.remove('was-validated');
                                    rentForm.reset();
                                });
                
                                utilityModal.on('hidden.bs.modal', function () {
                                    resetLoaderModal(utilityLoaderModal, utilityForm, utilitySubmitButton, 'Pay Utility');
                                    utilityForm.classList.remove('was-validated');
                                    utilityForm.reset();
                                });
                            });
                        </script>
                    </div>
                </section>
            </div>
        </div>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark"></aside>

        <!-- Main Footer -->
        <footer class="main-footer">
            <strong>Copyright © 2024-2025 <a href="https://leasecaptain.com/">Lease Captain</a></strong>
            All rights reserved.
            <div class="float-right d-none d-sm-inline-block">
                <b>Version</b> 1.0.2
            </div>
        </footer>
    </div>

    <!-- REQUIRED SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <script src="/dist/js/adminlte2167.js?v=3.2.0"></script>
    <script src="/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
    <script src="/plugins/raphael/raphael.min.js"></script>
    <script src="/plugins/jquery-mapael/jquery.mapael.min.js"></script>
    <script src="/plugins/jquery-mapael/maps/usa_states.min.js"></script>
    <script src="/plugins/chart.js/Chart.min.js"></script>
    <script src="/dist/js/demo.js"></script>
    <script src="/dist/js/pages/dashboard2.js"></script>
</body>

</html>